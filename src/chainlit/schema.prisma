datasource db {
    provider = "sqlite"
    url      = env("DATABASE_URL")
}

generator client {
    provider             = "prisma-client-py"
    interface            = "sync"
    recursive_type_depth = 5
}

model User {
    id            Int             @id @default(autoincrement())
    createdAt     DateTime        @default(now())
    updatedAt     DateTime        @updatedAt
    email         String?         @unique
    picture       String?
    name          String?
    projects      Project[]
    Conversation  Conversation[]
    UserToProject UserToProject[]
}

model Project {
    id            String          @id
    createdAt     DateTime        @default(now())
    name          String
    authorId      Int
    users         UserToProject[]
    conversations Conversation[]
    author        User            @relation(fields: [authorId], references: [id])
}

model UserToProject {
    id        Int     @id @default(autoincrement())
    project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
    user      User    @relation(fields: [userId], references: [id])
    projectId String
    userId    Int
}

model Conversation {
    id        Int        @id @default(autoincrement())
    createdAt DateTime   @default(now())
    sessionId String     @unique
    messages  Message[]
    documents Document[]
    projectId String
    project   Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)
    author    User       @relation(fields: [authorId], references: [id])
    authorId  Int
}

model Document {
    id             Int          @id @default(autoincrement())
    conversationId Int
    conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
    type           String
    url            String
    name           String
}

model Message {
    id             Int          @id @default(autoincrement())
    conversationId Int
    conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
    final          Boolean      @default(false)
    isError        Boolean      @default(false)
    indent         Int          @default(0)
    author         String
    content        String
    humanFeedback  Int          @default(0)
    language       String?
    prompt         String?
    llmSettings    String?
}
